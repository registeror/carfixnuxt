import{_ as Le}from"./C3d_DK6E.js";import{e as Be,u as We,r as l,k as je,f as Ze,y as Je,z as Qe,c as u,a,h as b,b as te,w as ae,A,t as X,i as E,v as S,F as O,p as R,B as Ge,o as c,C as He,d as Ye}from"./D1iNbD-i.js";import"./BbCOxZKf.js";import{u as p}from"./DQ2dyhc-.js";import"./_d1bhYXs.js";const et={class:"CategoriesBody"},tt={class:"vertical-container"},at={class:"button-container"},ot={key:0,class:"modal-overlay-accounts"},nt={key:0,class:"account-type-buttons"},st={key:1,class:"account-form"},lt={class:"account-input-group"},rt={key:0,class:"error-message"},ut={class:"account-input-group"},ct={key:0,class:"error-message"},it={class:"account-input-group"},dt={key:0,class:"error-message"},vt={class:"account-input-group"},mt={key:0,class:"error-message"},pt={class:"account-form-buttons"},ft=["disabled"],ht=["disabled"],yt={class:"search-container"},gt={class:"CategoriesCenter"},bt={class:"Categories",id:"section1"},Ct=["onClick","onMouseover"],_t={style:{"text-decoration":"none",color:"black"}},wt={key:0,class:"modal-overlay-promocode"},Pt={class:"modal-content-Promocode"},$t={class:"promocode-list"},kt={class:"promocode-fields"},At=["onUpdate:modelValue","onInput"],Et=["onUpdate:modelValue","onInput"],St=["onUpdate:modelValue","onInput"],Tt=["onClick","title"],Nt={key:1,class:"modal-overlay-addCategory"},It={class:"modal-content-addCategory"},xt={key:2,class:"modal-overlay-deleteCategory"},Xt={class:"modal-content-deleteCategory"},Ft={key:0},Ot={class:"slider"},Mt={class:"slides"},Dt={class:"container"},qt={class:"ProductPreview"},Rt=["src"],Ut={class:"ProductName"},Vt={class:"Price"},Kt={class:"ProductButton"},zt={class:"navigation"},Lt=["value","max"],Gt=Be({__name:"index",setup(Bt){const{public:{apiBaseUrl:v}}=We(),d=l(0),T=l(15),M=l([]),F=l(""),pe=l([]),f=l([]),U=l([]),oe=l(!1),V=l(!1),K=l(!1),P=l(""),ne=l([]),I=l(null),z=l(null),D=l(!1),L=l(!1),g=l(null),h=l(""),m=l(""),y=l(""),C=l(!1),_=l(!1),$=l(!1),fe=l(!1),w=l(!1),N=l(!1),k=l("");je(async()=>{try{const t=await $fetch(`${v}/api/admins/check-auth`,{credentials:"include",headers:{"X-XSRF-TOKEN":p("csrf").value}});!t.success||t.role!=="sAdmin"?window.location.href="/admin":(Y(),window.addEventListener("resize",Y),window.addEventListener("resize",ce),await Promise.all([le(),H(),J()]))}catch{window.location.href="/admin"}});const he=async()=>{if(Se())try{await $fetch(`${v}/api/admins/send-confirmation-code`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":p("csrf").value}})}catch{alert("Ошибка при отправке кода подтверждения")}},ye=async t=>{try{const e=await $fetch(`${v}/api/admins/get-account`,{method:"POST",body:{role:t},credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":p("csrf").value}});if(e&&e.login)h.value=e.login,g.value=t;else throw new Error("Данные учетной записи не получены")}catch(e){throw Q(),g.value=t,e}},B=t=>/^[a-zA-Z0-9!@#$]*$/.test(t),W=t=>t.replace(/[^a-zA-Z0-9!@#$]/g,""),ge=t=>{var n;const e=t.target;B(e.value)||(e.value=W(e.value)),h.value=e.value,w.value&&(C.value=!((n=h.value)!=null&&n.trim())||h.value.trim().length<6)},be=t=>{var n;const e=t.target;B(e.value)||(e.value=W(e.value)),m.value=e.value,w.value&&(_.value=!((n=m.value)!=null&&n.trim())||m.value.trim().length<6)},Ce=t=>{var n;const e=t.target;B(e.value)||(e.value=W(e.value)),k.value=e.value,w.value&&(N.value=!((n=k.value)!=null&&n.trim())||k.value.trim()!==m.value.trim())},_e=async()=>{var t,e,n,o;if(fe.value=!0,w.value=!0,!!g.value&&(C.value=!1,_.value=!1,N.value=!1,$.value=!1,C.value=!((t=h.value)!=null&&t.trim())||h.value.trim().length<6,_.value=!((e=m.value)!=null&&e.trim())||m.value.trim().length<6,N.value=!((n=k.value)!=null&&n.trim())||k.value.trim()!==m.value.trim(),$.value=!((o=y.value)!=null&&o.trim())||y.value.trim().length!==6,!(C.value||_.value||$.value)))try{await $fetch(`${v}/api/admins/update-account`,{method:"POST",body:{login:h.value.trim(),newPassword:m.value.trim(),role:g.value,confirmationCode:y.value.trim()},credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":p("csrf").value}}),G()}catch{$.value=!0}},j=t=>!/<[^>]*>|[\<\>\"\'\`\;\(\)\&\$\%\#\@\*\+\=\\\/\|\{\}\[\]]/.test(t),we=t=>!/[^a-zA-Zа-яА-Я0-9\s]/.test(t),Z=t=>t.replace(/<[^>]*>|[\<\>\"\'\`\;\(\)\&\$\%\#\@\*\+\=\\\/\|\{\}\[\]]/g,""),Pe=t=>t.replace(/[^a-zA-Zа-яА-Я0-9\s]/g,""),$e=t=>new Intl.NumberFormat("ru-RU",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t).replace(/\s/g,"."),J=async()=>{try{const t=await $fetch(`${v}/api/promocodes`,{credentials:"include",headers:{"X-XSRF-TOKEN":p("csrf").value}});pe.value=t,f.value=t.map(e=>({_id:e._id,"promocode-name":e["promocode-name"],"promocode-active":e["promocode-active"],"promocode-discount":e["promocode-discount"],isNew:!1})),U.value=JSON.parse(JSON.stringify(f.value))}catch{alert("Ошибка при загрузке промокодов")}},ke=async()=>{try{let t=!1;if(f.value.forEach(s=>{var me;s.hasNameError=!((me=s["promocode-name"])!=null&&me.trim()),s.hasActiveError=s["promocode-active"]===null||s["promocode-active"]<=0,s.hasDiscountError=s["promocode-discount"]===null||s["promocode-discount"]<1||s["promocode-discount"]>100,(s.hasNameError||s.hasActiveError||s.hasDiscountError)&&(t=!0)}),t){f.value=[...f.value];return}const e=U.value.map(s=>s._id),n=f.value.map(s=>s._id),r=e.filter(s=>s&&!n.includes(s)).map(s=>$fetch(`${v}/api/promocodes/${s}`,{method:"DELETE",credentials:"include",headers:{"X-XSRF-TOKEN":p("csrf").value}})),i=f.value.filter(s=>!s.isNew&&s._id).map(s=>$fetch(`${v}/api/promocodes/${s._id}`,{method:"PUT",body:{"promocode-name":s["promocode-name"],"promocode-active":s["promocode-active"],"promocode-discount":s["promocode-discount"]},credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":p("csrf").value}})),ee=f.value.filter(s=>s.isNew).map(s=>$fetch(`${v}/api/promocodes`,{method:"POST",body:{"promocode-name":s["promocode-name"],"promocode-active":s["promocode-active"],"promocode-discount":s["promocode-discount"]},credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":p("csrf").value}}));await Promise.all([...r,...i,...ee]),await J(),oe.value=!1,D.value=!1}catch{alert("Ошибка при сохранении промокодов")}},Ae=t=>{f.value.splice(t,1)},Ee=()=>{f.value.push({"promocode-name":"","promocode-active":null,"promocode-discount":null,isNew:!0}),oe.value=!0},Q=()=>{h.value="",m.value="",y.value="",C.value=!1,_.value=!1,$.value=!1,w.value=!1},G=()=>{L.value=!1,g.value=null,Q()},se=async t=>{g.value=t;try{await ye(t)}catch{alert(`Ошибка при загрузке данных ${t==="sAdmin"?"главного администратора":"сотрудника"}`)}},Se=()=>{var e,n,o,r;C.value=!1,_.value=!1,N.value=!1,$.value=!1;let t=!0;return(!((e=h.value)!=null&&e.trim())||h.value.trim().length<6)&&(C.value=!0,t=!1),(!((n=m.value)!=null&&n.trim())||m.value.trim().length<6)&&(_.value=!0,t=!1),(!((o=k.value)!=null&&o.trim())||k.value.trim()!==m.value.trim())&&(N.value=!0,t=!1),(r=y.value)!=null&&r.trim()&&y.value.trim().length!==6&&($.value=!0,t=!1),t},Te=async()=>{L.value=!0,g.value=null,Q()},le=async()=>{try{const t=await $fetch(`${v}/api/products`,{credentials:"include",headers:{"X-XSRF-TOKEN":p("csrf").value}});M.value=t,re(),q()}catch{}},Ne=async()=>{try{const t=await $fetch(`${v}/api/products/search/${F.value}`,{credentials:"include",headers:{"X-XSRF-TOKEN":p("csrf").value}});M.value=t,d.value=0,q()}catch{}};Ze(F,t=>{t.trim()===""?le():Ne()});const H=async()=>{try{const t=await $fetch(`${v}/api/categories`,{credentials:"include",headers:{"X-XSRF-TOKEN":p("csrf").value}});ne.value=t}catch{}},Ie=async()=>{if(!P.value.trim()){alert("Пожалуйста, введите название категории.");return}if(!j(P.value)){P.value=Z(P.value);return}try{await $fetch(`${v}/api/categories`,{method:"POST",body:{"categories-name":P.value.trim()},credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":p("csrf").value}}),await H(),de()}catch{alert("Ошибка при добавлении категории")}},xe=t=>{const e=t.target;j(e.value)||(e.value=Z(e.value)),F.value=e.value},Xe=t=>{const e=t.target;j(e.value)||(e.value=Z(e.value)),P.value=e.value},Fe=(t,e)=>{const n=e.target;we(n.value)||(n.value=Pe(n.value)),f.value[t]["promocode-name"]=n.value},Oe=async()=>{if(I.value)try{await $fetch(`${v}/api/categories/${I.value._id}`,{method:"DELETE",credentials:"include",headers:{"X-XSRF-TOKEN":p("csrf").value}}),await H(),ve()}catch{alert("Ошибка при удалении категории")}},Me=t=>!t.items||t.items.length===0?0:Math.max(...t.items.map(e=>e["product-price"])),x=Je(()=>Math.ceil(M.value.length/T.value)),Y=()=>{const t=window.innerWidth;t<=1023?T.value=6:t<=1279?T.value=9:t<=1539?T.value=12:T.value=15},q=()=>{const t=document.querySelector(".slides"),e=document.querySelectorAll(".page");if(e.length>0){const n=e[0].clientWidth;t.style.transform=`translateX(-${d.value*n}px)`}re(),De()},re=()=>{const t=document.querySelector(".nav-btn.prev"),e=document.querySelector(".nav-btn.next");t&&e&&(t.disabled=d.value===0,t.style.backgroundColor=d.value===0?"gray":"red",e.disabled=d.value===x.value-1,e.style.backgroundColor=d.value===x.value-1?"gray":"red")},De=()=>{const t=document.querySelector(".page-input");t&&(t.value=(d.value+1).toString(),t.style.backgroundColor="")},ue=()=>{const t=document.querySelector(".page-input");if(t){const e=parseInt(t.value,10)-1;if(e>=0&&e<x.value){const n=document.querySelector(".slides"),r=document.querySelectorAll(".page")[0].clientWidth,i=Math.abs(d.value-e),ee=Math.min(.5+i*.2,3);n.style.transition=`transform ${ee}s ease-in-out`,d.value=e,n.style.transform=`translateX(-${d.value*r}px)`,q()}else t.style.backgroundColor="#ffcccc"}},qe=t=>{const e=t.target;e.value=e.value.replace(/[^A-Z0-9]/g,"").toUpperCase(),y.value=e.value,w.value&&($.value=!y.value||y.value.length!==6)},ce=()=>{const t=document.querySelector(".slides"),n=document.querySelectorAll(".page")[0].clientWidth;t.style.transition="none",t.style.transform=`translateX(-${d.value*n}px)`,setTimeout(()=>{t.style.transition=""},0)},ie=t=>{const e=document.querySelector(".slides"),o=document.querySelectorAll(".page")[0].clientWidth;t==="prev"&&d.value>0?d.value-=1:t==="next"&&d.value<x.value-1&&(d.value+=1),e.style.transform=`translateX(-${d.value*o}px)`,q()},Re=async()=>{try{await J(),D.value=!0}catch{}},Ue=(t,e)=>{t["categories-name"]!=="Все"&&(I.value=t,K.value=!0)},de=()=>{V.value=!1,P.value=""},Ve=()=>{f.value=JSON.parse(JSON.stringify(U.value)),D.value=!1},ve=()=>{K.value=!1,I.value=null},Ke=async()=>{try{await $fetch(`${v}/api/admins/logout`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":p("csrf").value}}),window.location.href="/admin"}catch{}},ze=t=>{const e=t*T.value,n=e+T.value;return M.value.slice(e,n)};return Qe(()=>{window.removeEventListener("resize",Y),window.removeEventListener("resize",ce)}),(t,e)=>{const n=Le;return c(),u(O,null,[a("button",{onClick:Ke,class:"logout-class"},"Выйти"),a("div",et,[a("div",tt,[a("div",at,[te(n,{to:"/admin/sAdmin/admin-product"},{default:ae(()=>e[12]||(e[12]=[a("button",{class:"add-button"},"Добавить товар",-1)])),_:1}),a("button",{class:"add-button",onClick:e[0]||(e[0]=o=>V.value=!0)},"Добавить категорию"),a("button",{class:"add-button",onClick:Re},"Промокоды"),a("button",{class:"add-button",onClick:Te},"Учетные записи")]),L.value?(c(),u("div",ot,[a("div",{class:A(["modal-content-accounts",{expanded:g.value}])},[e[17]||(e[17]=a("h3",null,"Управление учетными записями:",-1)),g.value?b("",!0):(c(),u("div",nt,[a("button",{class:"account-type-btn",onClick:e[1]||(e[1]=()=>se("sAdmin"))},"Главный администратор"),a("button",{class:"account-type-btn",onClick:e[2]||(e[2]=()=>se("yAdmin"))},"Сотрудник"),a("button",{class:"account-type-btn cancel",onClick:G},"Отмена")])),g.value?(c(),u("div",st,[a("h4",null,"Изменение "+X(g.value==="sAdmin"?"главного администратора:":"сотрудника:"),1),a("div",lt,[e[13]||(e[13]=a("label",null,"Логин:",-1)),E(a("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>h.value=o),type:"text",placeholder:"Введите логин",required:"",class:A({invalid:C.value}),onInput:ge,style:{"border-radius":"2px"}},null,34),[[S,h.value]]),w.value&&C.value?(c(),u("span",rt,"Логин должен содержать минимум 6 символов")):b("",!0)]),a("div",ut,[e[14]||(e[14]=a("label",null,"Новый пароль:",-1)),E(a("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>m.value=o),type:"password",required:"",placeholder:"Введите новый пароль",class:A({invalid:_.value}),onInput:be,style:{"border-radius":"2px"}},null,34),[[S,m.value]]),w.value&&_.value?(c(),u("span",ct,"Пароль должен содержать минимум 6 символов")):b("",!0)]),a("div",it,[e[15]||(e[15]=a("label",null,"Подтвердите пароль:",-1)),E(a("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>k.value=o),type:"password",required:"",placeholder:"Подтвердите пароль",class:A({invalid:N.value}),onInput:Ce,style:{"border-radius":"2px"}},null,34),[[S,k.value]]),w.value&&N.value?(c(),u("span",dt,"Пароли не совпадают")):b("",!0)]),a("div",vt,[e[16]||(e[16]=a("label",null,"Код подтверждения:",-1)),E(a("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>y.value=o),type:"text",placeholder:"Код",maxlength:"6",required:"",class:A({invalid:_.value}),style:{"border-radius":"2px"},onInput:qe},null,34),[[S,y.value]]),w.value&&$.value?(c(),u("span",mt,X(y.value.trim()?"Код не верный":"Введите код подтверждения"),1)):b("",!0)]),a("div",pt,[a("button",{class:"account-form-btn action",onClick:he,disabled:!h.value.trim()||C.value},"Отправить код",8,ft),a("button",{class:"account-form-btn save",onClick:_e,disabled:!y.value.trim()},"Сохранить",8,ht),a("button",{class:"account-form-btn cancel",onClick:G},"Отмена")])])):b("",!0)],2)])):b("",!0),a("div",yt,[E(a("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>F.value=o),type:"text",placeholder:"Поиск товаров...",class:"search-input search-sAdmin",onInput:xe},null,544),[[S,F.value]])]),a("div",gt,[a("div",bt,[(c(!0),u(O,null,R(ne.value,(o,r)=>(c(),u("div",{class:"Сategory",key:r,onClick:i=>Ue(o),onMouseover:i=>z.value=r,onMouseleave:e[8]||(e[8]=i=>z.value=null),style:He({border:z.value===r&&o["categories-name"]!=="Все"?"2px solid red":"none"})},[a("a",_t,X(o["categories-name"]),1)],44,Ct))),128))])])]),D.value?(c(),u("div",wt,[a("div",Pt,[e[18]||(e[18]=a("h3",null,"Управление промокодами:",-1)),a("div",$t,[(c(!0),u(O,null,R(f.value,(o,r)=>(c(),u("div",{key:r,class:"promocode-item"},[a("div",kt,[E(a("input",{"onUpdate:modelValue":i=>o["promocode-name"]=i,type:"text",placeholder:"Название",class:A(["promocode-input",{invalid:o.hasNameError}]),onInput:i=>Fe(r,i)},null,42,At),[[S,o["promocode-name"]]]),E(a("input",{"onUpdate:modelValue":i=>o["promocode-active"]=i,type:"number",min:"1",placeholder:"Кол-во",class:A(["promocode-input",{invalid:o.hasActiveError}]),onInput:i=>o.hasActiveError=!1},null,42,Et),[[S,o["promocode-active"],void 0,{number:!0}]]),E(a("input",{"onUpdate:modelValue":i=>o["promocode-discount"]=i,type:"number",min:"1",max:"100",placeholder:"%",class:A(["promocode-input",{invalid:o.hasDiscountError}]),onInput:i=>o.hasDiscountError=!1},null,42,St),[[S,o["promocode-discount"],void 0,{number:!0}]])]),a("button",{onClick:i=>Ae(r),class:"delete-promocode-btn",title:o.isNew?"Отменить добавление":"Удалить промокод"},"×",8,Tt)]))),128))])]),a("div",{class:"modal-content-AddPromocode-buttons"},[a("button",{class:"modal-button-addCategory save",onClick:ke},"Сохранить"),a("button",{class:"modal-button-addCategory add",onClick:Ee},"+"),a("button",{class:"modal-button-addCategory cancel",onClick:Ve},"Отмена")])])):b("",!0),V.value?(c(),u("div",Nt,[a("div",It,[e[19]||(e[19]=a("h3",null,"Введите название категории:",-1)),E(a("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>P.value=o),type:"text",placeholder:"Название категории",onInput:Xe,class:"modal-input-addCategory"},null,544),[[S,P.value]]),a("div",{class:"modal-buttons-addCategory"},[a("button",{class:"modal-button-addCategory add",onClick:Ie},"Добавить"),a("button",{class:"modal-button-addCategory cancel",onClick:de},"Отмена")])])])):b("",!0),K.value?(c(),u("div",xt,[a("div",Xt,[I.value?(c(),u("h3",Ft,'Вы действительно хотите удалить категорию: "'+X(I.value["categories-name"])+'"?',1)):b("",!0),a("div",{class:"modal-buttons-deleteCategory"},[a("button",{class:"modal-button-deleteCategory delete",onClick:Oe},"Удалить"),a("button",{class:"modal-button-deleteCategory cancel",onClick:ve},"Отмена")])])])):b("",!0)]),a("div",Ot,[a("div",Mt,[(c(!0),u(O,null,R(x.value,o=>(c(),u("div",{key:o,class:A(["page",{active:d.value===o-1}])},[a("div",Dt,[(c(!0),u(O,null,R(ze(o-1),(r,i)=>(c(),u("div",{class:"item",key:i},[a("div",qt,[te(n,{to:`/admin/sAdmin/admin-product/${r._id}`},{default:ae(()=>[a("img",{src:r["product-image"],style:{width:"100%",height:"100%"}},null,8,Rt)]),_:2},1032,["to"])]),a("div",Ut,X(r["product-name"]),1),a("div",Vt,[Ye(X($e(Me(r)))+" р",1),e[20]||(e[20]=a("p",{class:"quantity"},"/1шт",-1))]),a("div",Kt,[te(n,{to:`/admin/sAdmin/admin-product/${r._id}`},{default:ae(()=>e[21]||(e[21]=[a("button",{class:"ProductBtn"},"Изменить товар",-1)])),_:2},1032,["to"])])]))),128))])],2))),128))]),a("div",zt,[a("button",{class:"nav-btn prev",onClick:e[10]||(e[10]=o=>ie("prev"))},"<"),a("input",{class:"page-input",type:"number",value:d.value+1,onInput:ue,onKeyup:Ge(ue,["enter"]),min:"1",max:x.value},null,40,Lt),a("button",{class:"nav-btn next",onClick:e[11]||(e[11]=o=>ie("next"))},">")])])],64)}}});export{Gt as default};

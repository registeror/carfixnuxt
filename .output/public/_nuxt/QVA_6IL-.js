import{_ as I}from"./C3d_DK6E.js";import{e as T,j as b,u as N,r as c,y as D,f as y,k as R,c as i,a as o,S as V,b as O,w as U,h as $,t as p,i as j,q as M,F,p as X,s as q,o as l}from"./D1iNbD-i.js";import{_ as E}from"./B1kpTUC2.js";import{_ as L,a as z}from"./BA0to53R.js";import"./BbCOxZKf.js";import{e as A,u as G,f as K}from"./DoPRmHpb.js";import{u as k}from"./DQ2dyhc-.js";import{u as H}from"./-80ydLg_.js";import"./_d1bhYXs.js";const J={class:"GoBackBody"},Q={key:0,class:"loading-overlay"},W={key:1},Y={class:"PageProductBody"},Z={class:"PageProductContent"},ee={class:"PageImageProduct"},te=["src"],oe={key:1,style:{width:"100%",height:"100%","object-fit":"cover"},loading:"lazy",src:E},se={class:"PageProductRightBlock"},ae={class:"PageProductText"},ie={class:"PageProductName"},le={class:"PagePriceForOne"},re={key:0,class:"PageVolumeSelect"},ue=["value"],ce={class:"PageProductDescriptionBlock"},de={class:"PageProductDescription"},Fe=T({__name:"[id]",setup(ne){const P=b(),x=q(),g=P.params.id,{public:{apiBaseUrl:h}}=N(),r=c(null),u=c(""),n=c(""),s=c([]),f=P.query.volume,a=c(""),_=c(!0);c(!1);const d=D(()=>{const t=s.value.find(e=>e["product-volume"]===a.value);return t?t["product-price"]:0}),B=t=>new Intl.NumberFormat("ru-RU",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t).replace(/\s/g,"."),S=async()=>{try{_.value=!0;const t=await $fetch(`${h}/api/products/${g}`,{credentials:"include",headers:{"X-XSRF-TOKEN":k("csrf").value}});u.value=t["product-name"],n.value=t["product-description"],r.value=t["product-image"],s.value=t.items||[],y([u,n,d],()=>{d.value&&H(A(u.value,n.value,d.value,g,r.value))},{immediate:!0}),G([K({name:u.value,image:r.value,description:n.value,offers:s.value.map(e=>({price:e["product-price"],priceCurrency:"RUB"}))})]),s.value.length>0&&s.value.sort((e,v)=>v["product-price"]-e["product-price"]),f&&s.value.some(e=>e["product-volume"]===f)?a.value=f:s.value.length>0?a.value=s.value[0]["product-volume"]:a.value="1шт",_.value=!1}catch{await x.push("/")}};y(a,t=>{var e;t&&!s.value.some(v=>v["product-volume"]===t)&&(a.value=((e=s.value[0])==null?void 0:e["product-volume"])||"")});const w=async()=>{const t=C();if(!(!u.value||!d.value||!r.value))try{await $fetch(`${h}/api/baskets/add`,{method:"POST",body:{userId:t,"items-product-id":g,"items-product-name":`${u.value}`,"items-price":d.value,"items-product-image":r.value,"items-quantity":1,"items-product-volume":a.value||"1шт","items-has-volume":s.value.length>1},credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":k("csrf").value}})}catch{}},C=()=>{let t=localStorage.getItem("userId");return t||(t=Math.random().toString(36).substring(2)+Date.now().toString(36),localStorage.setItem("userId",t)),t};return R(()=>{S()}),(t,e)=>{const v=I;return l(),i(F,null,[e[4]||(e[4]=o("meta",{charset:"utf-8"},null,-1)),e[5]||(e[5]=o("meta",{name:"viewport",content:"width=device-width, initial-scale=1"},null,-1)),e[6]||(e[6]=o("title",null,"Авто-химия",-1)),e[7]||(e[7]=o("link",{rel:"icon",href:"@/image/IcoL.ico",type:"image/x-icon"},null,-1)),o("div",J,[O(v,{to:"/"},{default:U(()=>e[1]||(e[1]=[o("a",{class:"BtnGoBack"},"<- назад",-1)])),_:1})]),_.value?(l(),i("div",Q,e[2]||(e[2]=[o("div",{class:"loading-spinner"},null,-1)]))):(l(),i("div",W,[o("div",Y,[o("div",Z,[o("div",ee,[r.value?(l(),i("img",{key:0,loading:"lazy",style:{width:"100%",height:"100%","object-fit":"cover"},src:r.value},null,8,te)):(l(),i("img",oe))]),o("div",se,[o("div",ae,[o("div",ie,p(u.value),1),o("div",le,p(B(d.value))+" р/1шт",1),s.value.length>1?(l(),i("div",re,[e[3]||(e[3]=o("label",{for:"volume-select",id:"volume-select-text"},"Размер:",-1)),j(o("select",{id:"volume-select","onUpdate:modelValue":e[0]||(e[0]=m=>a.value=m),class:"VolumeSelect"},[(l(!0),i(F,null,X(s.value,m=>(l(),i("option",{key:m["product-volume"],value:m["product-volume"]},p(m["product-volume"]),9,ue))),128))],512),[[M,a.value]])])):$("",!0),o("div",{class:"PageButtonProductAdd"},[o("button",{class:"PageBtnProductAdd",onClick:w},"Добавить в корзину")])]),o("div",ce,[o("div",de,p(n.value),1)])])])])])),e[8]||(e[8]=V('<div class="PageFooterBody"><div class="PageFooterBodyContent"><div class="PageFooterContacts"><h2 class="FooterTitle">Краснодар:</h2><div class="PageFooterTextContent"><p class="FooterText">+7(928)660-97-79</p><p class="FooterText">+7(928)227-55-15</p><p class="FooterText">+7(967)660-09-51</p><p class="FooterText">+7(967)660-09-47</p><p class="FooterText gmail">info@himautopro.ru</p></div></div><div class="PageFooterSocial"><div class="PageFooterSocialContent"><div class="PageSocial"><img src="'+L+'" style="width:45px;"><img src="'+z+'" style="width:45px;"></div></div></div></div></div>',1))],64)}}});export{Fe as default};

import{_ as y}from"./C3d_DK6E.js";import{e as b,r as i,u as _,f as x,c as m,o as p,b as C,a,w as h,g as k,h as A,i as f,v,t as K,F as S,n as c}from"./D1iNbD-i.js";import{u as T}from"./DQ2dyhc-.js";const B={class:"login-container"},N={class:"form-group"},V={class:"form-group"},D={key:0,class:"error-message",style:{"margin-top":"6px"}},U=b({__name:"index",setup(F){const l=i(""),{public:{apiBaseUrl:g}}=_(),t=i({login:"",password:""}),n=i({login:"",password:""}),r=i(!1);x(t.value,o=>{(o.login!==n.value.login||o.password!==n.value.password)&&(r.value=!0,l.value="")},{deep:!0});const w=async()=>{var o,e;if(!(!r.value&&l.value))try{const s=await $fetch(`${g}/api/admins/login`,{method:"POST",body:t.value,credentials:"include",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":T("csrf").value}});s!=null&&s.success?(n.value={...t.value},s.role==="sAdmin"?await c("/admin/sAdmin"):s.role==="yAdmin"&&await c("/admin/yAdmin")):(l.value=(s==null?void 0:s.message)||"Неверный логин или пароль",n.value={...t.value},r.value=!1)}catch(s){s.statusCode===401?l.value=((o=s.data)==null?void 0:o.message)||"Неверный логин или пароль":s.statusCode===429?l.value=((e=s.data)==null?void 0:e.message)||"Слишком много попыток. Попробуйте позже.":l.value="Произошла ошибка при входе",n.value={...t.value},r.value=!1}},d=o=>{!/^[a-zA-Z0-9!@#$]*$/.test(o.key)&&!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(o.key)&&o.preventDefault()};return(o,e)=>{const s=y;return p(),m(S,null,[C(s,{to:"/"},{default:h(()=>e[2]||(e[2]=[a("button",{class:"logout-class"},"Перейти на главную страницу",-1)])),_:1}),a("div",B,[a("form",{onSubmit:k(w,["prevent"]),class:"login-form"},[e[5]||(e[5]=a("h2",{class:"form-title"},"Вход",-1)),a("div",N,[e[3]||(e[3]=a("label",{for:"username",class:"form-label"},"Имя пользователя:",-1)),f(a("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=u=>t.value.login=u),onKeydown:d,class:"form-input",placeholder:"Введите имя пользователя",required:""},null,544),[[v,t.value.login]])]),a("div",V,[e[4]||(e[4]=a("label",{for:"password",class:"form-label"},"Пароль:",-1)),f(a("input",{type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=u=>t.value.password=u),onKeydown:d,class:"form-input",placeholder:"Введите пароль",required:""},null,544),[[v,t.value.password]])]),e[6]||(e[6]=a("button",{type:"submit",class:"submit-button"},"Войти",-1)),l.value?(p(),m("p",D,K(l.value),1)):A("",!0)],32)])],64)}}});export{U as default};
